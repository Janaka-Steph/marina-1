import type { MakeClaimTransactionParams } from '../src/pkg/boltz';
import { Boltz, boltzUrl } from '../src/pkg/boltz';
import { networks } from 'liquidjs-lib';
import ECPairFactory from 'ecpair';
import { randomBytes } from 'crypto';
import * as ecc from 'tiny-secp256k1';

describe('Boltz Atomic Swap', () => {
  it('should construct claim transaction', async () => {
    const zkpLib = await require('@vulpemventures/secp256k1-zkp')();
    const boltz = new Boltz(boltzUrl['regtest'], networks['regtest'].assetHash, zkpLib);
    const claimPrivateKey = randomBytes(32);
    const claimKeyPair = ECPairFactory(ecc).fromPrivateKey(claimPrivateKey);
    const params: MakeClaimTransactionParams = {
      utxo: {
        txid: 'aaa5c39294b7cefa5e1b0566e868cd8225d1a5a30cb40c905093ebe0642e2e7c',
        vout: 0,
        blindingData: {
          asset: '144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49',
          assetBlindingFactor: '89c5a352c12427b5c91a2de6c04a7d601f3c2c9ba208c048edf30b96ec5db311',
          value: 9684,
          valueBlindingFactor: '2edfbdf4fe8759bf72bdd7daa724e6caad5ffba86eebc32e661c82f0b6ee026f',
        },
        witnessUtxo: {
          asset: Buffer.from(
            '0afdd49a022ce6b9f08ea8c37d64fd879413e91dc0616c22fee5e78683c174d977',
            'hex'
          ),
          nonce: Buffer.from(
            '021a8411b62f1571407eff32e8d4c3f41e66d7448e0cbdba8000e5657ea839ce93',
            'hex'
          ),
          rangeProof: Buffer.from(
            '60330000000000000001ba05ce016079e1f4f9df43f74aca7e86464733b00fdf00167f22868273be64eccf62bd13757c6d546db9752547454cb435d310128886a79061ad36142549d20ae8ded25fb9d4a43cb53498283b78f0264ce07a663141d7cb8a9a5f8de912bf173e6abdb03d16b182fed4cb15a637211881c08f2f62dcf67a84c25d304eca10ea9df5c74ad48105ff2576d772a58cf13a469ddcf44197c1989a1987501962a0e7504e6b8fc1d99acf4018967fc7e158c863fbeeb36eb714160bb9ba76e6df9812e1ab7ee6634f8b691f675b2a48f2ec34e40bcd7bf682dcd3dd354db9fa3ad4b41b46d58bcbcca29aeb389cb933c8f0e24577e6cdee83e780dedfcec060bebedd46b7b02bb3aa1fde0aebe1ed818c5c8aedfdc1675fc582454e74e5165629a8e23cf07c600a66bc796a43153c46b685296d0889a3a1e37f78903be3379ba10dff617ed136d6a4eb537e2b08affe8ed1b1b78a3b29c73cfe5daec4fa36f3de7ea23a291bf06b562826be4aa8dbf4936dbe746fee542dfb77fe554095ede1ff873b7b0a4ac03ca6cca7940f1b01763156d1ecdc04687ca69922be0b7bddf1a4603a524c0e36764834ab4e3395a6b3ab73550e6384abe3d31b1ddb8775db74add202805b5da8976c24684fbc9ad0efdde0d06a3ea619fb822b2f21d0a15d5a309ba32af0c3f740ccc7f7267fe40a07718fd6b510d05b65a4053d033195a9a9c7369ac17627b27eca1079f6fdc66d62f79d4bd40582183302b8165d6169f9dd6bef3a89e85f63c24a04fc12aa1d9ab39fe4c471053fbe8e315413527573bb024ed0c2b33a49ccba4edc7799d87e43d3fb241533ab0e08853aee6dc9c56202a35fe86418f727f3e4213b7a575500fcb323d23159a1b1f281a5f1d8e4b9c7051b1713985fe0f3d62bc5aea93c14f0237292f6d36e0fd37786391b6868291921652bdebe50906a91c4433e64747f686fbe72439f449d85ddcbba248e865ce1c800774a480b2d9d07213f9ee57ae34311befc72074ebdd521ed919c2ef5edb4f3472cdbecb996fd0364fb1138eb6991b5ef4348e22cf48c6099d082b9cb954ae44018acb37f0140d706262df18b46ebf4733ba8427760349c8bb81349ab4e3f2d8e45fd58591e2fac14c53fcbc311421da41f3c13cfeef7694ca713139acb5f935a8097985d98d11d5110ba610f706cf0d73cb19ee1bd490f3c098a0fca59b148ddcf4b715b8aeb05606e6c1de62c80b36315124fd3e343f58187f94cacbbbfbbadb304b95238762b60e8c26212ff6ac169bbeff00b42cc5941cf7f82602a625758066d207da981a96cfd2a02aa239259d159d64b7826fcdeda35f9f53cb97304f27c8eddd79b2bd3e99cc31355d6f9c606a850b70e6f0f69504176f9a630a69ae7573b3057d00a1d76c3c85bdc87faa911cf49e2e8b44df70ab67c32ceab4985aa29fae40182bfa0e13e114ade97cb0a0f5b8b3b6efa8744686ffd7b157eb2396ec1be21cc9a1468c89ef0570827cdc5fee8f495cd276cdac5989b5309c27ee95037205550fcf0b8c55786a9356100c605006d313a6fecbfcd4a8eff72f958df53f9a4de10cb1fcca5e691dbdca4233b5f217aa82f21f27094dd1fabc0f00106eddd094c50a475d4d2e41d00eab68f3e927e7eeba345ce3e751114c7c0d3091a0241c307b22ed97bea7e7643ba3ecaf4c1b53372bbb661c1c2efb37b2c2f42d04ba94226360a94d1cc92e8e915227d54f2a8150c12fdd571a5a48e5db0ecc30d35c2071bf7c523d6862c71dfb59ef81e67cf59ab8549767ac1e51b0657222fe2a9d8079ecbb7db14245af06c8eb2f36a98c57865d79a7cc8c0289c2f497a1344dd0f8f91077864913222b1997e78090dddaa6d3b73f2a9c5f996888046c206439647758fb55b69a19029c8e3a8bb11e310ce881178dd3f9e86d035aae186361f0ede78bac243e1953b65e5012c3f8500c94f9d246c545c383b8044a1943840ea1a6e1e619a3d2bafeffe684023bcab51ff5a7dd9972f995259dd9fd6a241049a4f6bf53409b7a53355713d0bc9588b37d8e4f4f34b5c4e967e11b0eb9b490aa8e49f40b95623d4854751ff52f9b6d58d0364a9f54877fbf140be7d5a6925f8039e54aa52ed1905e0ec8f48b80f02e04dc9b1aae66ff40882d7b62d57bbe83f3130b6ee031781924b2380bb05e6897e4c6d720831bb54a00de446a7d3d0aac970b50c764594d13a009a96e126b4a5f028b04caf0bbd13948f8a6c0e866d7bd0d9136ae9b017f57671cde36812076676d0fcd4892ecfb168a919e7e5f1bd9070a986a9e8acee749ccb8d731a485eb0274d260a87f3da6f6567f3b68fffaae0d651db19003619f394bd02fe3077276cebe2e2a646ac39b40741365c918225a89cee0b0c237b946f4ba13bbea4965e19dfae8ddc9fd44a770eac69bbe77dce22302a17fcb350ad2ff0cb0a21bce2df7d44b5644f1d4136e305dd976af2ae120ad3b1f16a016b18099ada08dfa9bceb090a4b0faeea743529f41b8a7c2cbec0eb8b1f8c19ced4690d3667241de42ea5348b0209f5785112611d1d4b585fad7f96dc43c8a4451f9630b36d860f4e8fa81f60102a8166a470997c370a42c1a2d7e67511801236da6feadae2cc559aa386432e589ce5e5e9c386589193323da008ec986df5a7e448593f43b441b46d26a04ccf61ff0a9f6ac77ff2e006b3dc688194f5116cda1c36c83e42a530fed5442d08a2bcd5ec662ef82283af4ae1df8c75073545edd71e24d09fe0ee3750b7e0788f96c639a3680ed0f1ad6ddb2746cd39b30fa7c7212a87436513ec758de981757802f8a7b688420dadc00e8f849bb3706df7958bda83ccf10d85dcf0899f2d60281b60f1cfdb7e956e79863c23c5d3861f71c5d44f5d9453ff50fc3141e7afdb9f214db8ecb068152d2b648b66cd8f49a1ec55c49fbaff38bddbf7d621b4782b04f252710fd2da0b354ac2f6ebdb372f13cfa7eb65338ec03383a41984977c92c7591029e752257deaec29905b9e6a258c5098d4b316e389f89cbaf93741a649be1f92b272dea19e9763f395a6adc4ade60abf04fc4c11e1a8e6773be259076fa92e659ad22525e91d5fca4998429b89582e4a00ba536cf58b3feb5da689d1e1711ebf37db8ac4367b0db8879eaf0932814e90c38b59d1719eb458a400a480dd61266032bb8762457fd82ce28d52dd4197eb6047a83f6075197bd29c593b17748e4f9bbe926bf640536a8571ad639b8df8e747d1bd4c5fe65ff923b384ee15ebf2363e40039b46038fcf25c0868aaa23516e3cfc04ba3b5ad27d0c5a364da076e46c818c434b9345883eb700439df203eca11f181f18e5924a1662a86aa1457001a556fb5289b14c592ea2f95583ad6bd5937bdba053f728223bbfa2e20a46a4e88f01c855d020b1c885a0c13eafffd5dddc72f3dbd7b12eaed594a2dbef3a88aafa824992f01dc097c6270a729ba34084510cac23eed18d3f9271dc24ce205c1f94e5e2125ebf200a7820195a1ed8262fa6918267067329d81ee33b3f7bde0248a5fe4609b60d9244dba7b8167c607b0408fdccebe2f065c86c369e161f1242d2db7135cc534c31f075aa2b2aca974e3140987b3a00b46bed25f92be1be104ff3d31e6fe015aea30c9f04c759ca24894b9d15a2bbaf386d3a73eda78306c5bd61718b94eb35f6256cec01c6359591b8036c29cdd2f2d14bc90b91a6f6d18e233279fb358bc2a94a6c2cf583fa6e5e582a3f2b62ed191f07e6cc2479380e22807827f9234ad0fcffd4bdc5da6412fd98190f8a9c2799f4e383efc84a3374729260cca380fa9758e7c0c4e572c8957a470e0dc57a99e298158f67b04df01f04514b71b7aa4e839c61ccad7843cbc3abb36e45cd53069b6e701f1d23c1bbc2313563216e38f5751b5aea0dc17d76ca62e9965500c38efcd2da184660cce28642d5c93373bd9a416f4012167fd6263d12ae036b7703a74b956c277b090ebb513f912fbffb701b20567c3ae3c42aba8fc07fb6b1919df1b4797ecb314840ca9d678d51e626c76d5b5592c80f924db8ea0539fed419e02cec44c662feafc7c66aba50de36a3960b92d029e3a96299398849c28a24b7fe60cbfb28e377c07945bd4973437c2404453f342e1e5696ea092d693e425e2642df7898dff1d79dc54d97b3267b39f7667814d29f047b8d54b6acd22f5ab0715e3192fce17fe054584f85cbd650823c4a4b113ca9cac512f570d3d0d902fb776e0cef49d57fb0f004264fe493b1e4d889b00dec0af06d0ee4ddd6e9f7b4da182335e0f3fff96ed17749252e4ac1da5b68e71c3a7fd6563e4fc3ea2218b8854e49d1ee7e474cd459547e27ba0f14234dae203a9df514975991fa852432fcbaea64422bd832404daffef46dd49e000118ea86e242fb52811eec588f63616924da0386e22848ea346e4b8219a16a48d44c697a4013151920aa3e2eee870b069ae6c401d3223f12074a941fbfb7c510f3f29b568f7460df4c9bb04b69a738ef9bd07392d8dc6d7a0aa3419b94b2d215c87382b160ec138351165d815e95beb8261e74cb3a30a4a05a94519274f62653f177ca290ed2615ae4146a874ae516a90eb75603951bbd7f639b44b189ff709f256558fc8df9ccc2690e719b80635994a7e1cb3387b13bcb298d0dfe001273bda11ba835b91969e4943072a3a7f534f0846ab888bf18e9d1cc4615a0666ba65ba5dac52ba3cdded90ebdae0af823f56f5228a17f9a82e7f731860649ab43c3c7640ad4b667713ed29f7287b23dce68ad140ae20b8b38bdd1456ba70f24cafe80244a073d7bd1bfed45d9a7aefa1f95741f1c273535a1443ed5c362c1e32644612c4414c2241385c291cda5d17cf49811bcb62050380939ffd3b585700ea66942ff125f876884f90865a45ea1b590b05ad14571e1bd4aa835bd45ad5445ba26d21c8a0d31611398fdcab5c170a7cede73848919475dc742824163564f10e0ecb8b51bdbca86325a00996c30a85e18dd0c9c503c76a953b3fbcd6b3831a583ca81fdc088ecfb8fde19d10f2ef1182077ee285ec7eeedc0a7307eeea337947c217491b5e059ee058135564bd7f4c2f3ca45a55adc70e31ec8caf278532b663107c814bc0f46f97b8eeedb4bc23bd2a3a1e3850d1936e2f762c0865e2605f444ca89be6b5d6d03210b58804867924bb22bb4c21a56604b1b24db2d58e8ffd9f65ed1809f860b7a78321b867aebde9bd08716ff6cb4ab276bd669586ee9f98c50cc21da2e7ad530b634198508a9b7cc053cae8a75e977c6c39d3d288cb2ad9d9223d2189c9a5f98d4bb58875420e0507de616d6dd5dafc45ad88ae6d6ed7684bd22d74ef9bc0e69bee33e7203102edd26280340f76c5406706d3b252fcea556083f76188f0c10401a02de883c0590953e5fc27d494d331d369fed18d7c50e9dc4cd84c99109cc6884a662333547e74805fcd7fb8c6d632c7184921c804a18fa9bbb9682c0e196028fecd1c88e6fa02882ec0bae072f1977fb009c213957a41359aa69692bad47106759a9a666ac41227c9e525a41ccff3ec008da694f0d42ba1723d162c6fae388d816919d77669890c7dfcdab9a8e7f323e98f4f79f6e1c0193eaaac26193ccd2ebd620fdc6a74757c7e0b915b3a4bb1a1e1851e626a634c79eb44db78cb1b0ad0396aee8ba8c05339a08340ed7093d337d1646a20528936131e2713b6b236d4d7c1b30866097dca61aa41f9083cee1899d4c49d4aeb8fccc6a61cd1215dd57b9508ec75eff952c46580993cd0cb9b0ad2ec873e8ed1ccbd3e0bd5ae75d2d07756d7c5d58cee71248a51a99489a6e8bbf8f0f61f6fc9475603606b13cf4dd4bed488ae522078851f184d2864b1cab4ee68f33e50593',
            'hex'
          ),
          script: Buffer.from(
            '0020c7b91c9c9ce871767d85e7bbab9ddbbb3c7f3e0983ea0cfc34b763c78b3cb304',
            'hex'
          ),
          surjectionProof: Buffer.from(
            '0100015e2040528de6a578791a6b339b093648ec9efaed2f6a487219f3bf2e8ab9c39cd38914b5f8ed2369cc7a6bea600ee937f4a589eee4292720db87dfd294585865',
            'hex'
          ),
          value: Buffer.from(
            '090a0e0d56a077da2d6b8c029aad18486fc3a786bb3f72317d8636e3dbf0687a9d',
            'hex'
          ),
        },
      },
      claimKeyPair: claimKeyPair,
      preimage: Buffer.from(
        'c2515f938916ab4f81c36247170bdb5786ced6c9145b70b83749278aaab0888c',
        'hex'
      ),
      redeemScript: Buffer.from(
        '8201208763a914ed43cf17f4260b582d9fa0455f16687b95f75630882103984206398aca56687dc12833498e324fed77aa1b934524a1a55518732990952e67750351670eb1752102f1ca6a6a75f952b92a5f58438ea5d3333e4c1ca4aa1a5450c5f212d6886fdc8c68ac',
        'hex'
      ),
      destinationScript: Buffer.from('00143f0f6c89794ea7789ee32a0f16d3a012f763f91f', 'hex'),
      fee: 300,
      blindingPublicKey: Buffer.from(
        '02c2c42bbbf0f619af55626188f3d5783b7352ba77491465f62f0b9be6f51f142a',
        'hex'
      ),
      timeoutBlockHeight: 943953,
    };
    const claimTx = boltz.makeClaimTransaction(params);
    console.log('claimTx', claimTx);
    expect(claimTx).toBeDefined();
  });
});
